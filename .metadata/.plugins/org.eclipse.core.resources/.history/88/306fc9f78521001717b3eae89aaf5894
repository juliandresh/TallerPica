<!-- swift-business-process BPEL Process [Generated by the Eclipse BPEL Designer]  -->
<!-- Date: Mon Mar 05 12:18:58 IST 2012 -->

<bpel:process name="swift-business-process"
         targetNamespace="http://swift.business.process"
         suppressJoinFailure="yes"
         xmlns:tns="http://swift.business.process"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:brms="http://javeriana-maintenance/brms"
         xmlns:rep="http://mtx.enterprise/services/reporter"
		 xmlns:fil="http://mtx.enterprise/services/filter"
         xmlns:mop="http://aerolineas-latinoamericana.com/soa/mop-message/mop-rule/"
		 xmlns:proc="http://aerolineas-latinoamericana.com/soa/processes/crew-message/process-crew-message/"
		 xmlns:inc="http://aerolineas-latinoamericana.com/soa/processes/incidents-message/process-incidents-message/">>
    
    
    <!-- Import the client WSDL -->
    <bpel:import namespace="http://mtx.enterprise/services/reporter" location="providers/reporting-service.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
    <bpel:import namespace="http://mtx.enterprise/services/filter" location="providers/filter-service.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
    <bpel:import location="swift-business-processArtifacts.wsdl" namespace="http://swift.business.process" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />

	<bpel:import location="providers/business_rule.wsdl"
		namespace="http://javeriana-maintenance/brms" importType="http://schemas.xmlsoap.org/wsdl/" />

	<bpel:import location="providers/filter-service.wsdl"
		namespace="http://mtx.enterprise/services/filter" importType="http://schemas.xmlsoap.org/wsdl/" />
	
	<bpel:import location="providers/reporting-service.wsdl"
		namespace="http://mtx.enterprise/services/reporter" importType="http://schemas.xmlsoap.org/wsdl/" />
		
	<bpel:import location="providers/mop-service.wsdl"
		namespace="http://aerolineas-latinoamericana.com/soa/mop-message/mop-rule/" 
		importType="http://schemas.xmlsoap.org/wsdl/" />
	
	<bpel:import location="providers/crew-service.wsdl"
		namespace="http://aerolineas-latinoamericana.com/soa/processes/crew-message/process-crew-message/"
		importType="http://schemas.xmlsoap.org/wsdl/" />

	<bpel:import location="providers/incidents-service.wsdl"
		namespace="http://aerolineas-latinoamericana.com/soa/processes/incidents-message/process-incidents-message/"
		importType="http://schemas.xmlsoap.org/wsdl/" />
	
    <!-- ================================================================= -->         
    <!-- PARTNERLINKS                                                      -->
    <!-- List of services participating in this BPEL process               -->
    <!-- ================================================================= -->         
    <bpel:partnerLinks>
        <!--
        The 'client' role represents the requester of this service. -->
        <bpel:partnerLink name="client"
                     partnerLinkType="tns:swift-business-process" myRole="swift-business-processProvider"/>
 
 		<bpel:partnerLink name="businessRuleServicePartnerLink"
			partnerLinkType="brms:businessRulePortType_PLT" partnerRole="businessRulePortType_Role"
			initializePartnerRole="yes" />
			
		<bpel:partnerLink name="mopPartnerLink"
			partnerLinkType="mop:mopPortType_PLT" partnerRole="mopPortType_Role"
			initializePartnerRole="yes" />

		<bpel:partnerLink name="crewServicePartnerLink"
			partnerLinkType="proc:crewPortType_PLT" initializePartnerRole="yes"
			partnerRole="CrewPortType_Role" />

		<bpel:partnerLink name="incidentServicePartnerLink"
			partnerLinkType="inc:incidentPortType_PLT" initializePartnerRole="yes"
			partnerRole="IncidentPortType_Role" />
        <bpel:partnerLink name="filterPartnerLink" partnerLinkType="fil:filterPortType_PLT" partnerRole="filterPortType_Role"></bpel:partnerLink>
        <bpel:partnerLink name="reportingPartnerLink" partnerLinkType="rep:reportingPortType_PLT" partnerRole="reportingPortType_Role"></bpel:partnerLink>
    </bpel:partnerLinks>
  
    <!-- ================================================================= -->         
    <!-- VARIABLES                                                         -->
    <!-- List of messages and XML documents used within this BPEL process  -->
    <!-- ================================================================= -->         
    <bpel:variables>
        <!-- Reference to the message passed as input during initiation -->
        <bpel:variable name="input" messageType="tns:swift-business-processRequestMessage"/>
        <bpel:variable name="output" messageType="tns:swift-business-processResponseMessage"/>
        
        <bpel:variable name="incident_input" messageType="inc:reportIncidentRequest"></bpel:variable>
		<bpel:variable name="incident_output" messageType="inc:reportIncidentResponse"></bpel:variable>

		<bpel:variable name="crew_input" messageType="proc:changeCrewRequest"></bpel:variable>
		<bpel:variable name="crew_output" messageType="proc:changeCrewResponse"></bpel:variable>

		<bpel:variable name="brms_input" messageType="brms:evaluateRuleRequest"></bpel:variable>
		<bpel:variable name="brms_output" messageType="brms:evaluateRuleResponse"></bpel:variable>
        <bpel:variable name="mop_input" messageType="mop:mopEventRequest"></bpel:variable>
        <bpel:variable name="mop_output" messageType="mop:mopEventResponse"></bpel:variable>
        <bpel:variable name="filter_input" messageType="fil:evaluateAircraft"></bpel:variable>
        <bpel:variable name="reporting_input" messageType="rep:generate"></bpel:variable>
    </bpel:variables>

    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->         
    <bpel:sequence name="main">
        
        <!-- Receive input from requestor. 
             Note: This maps to operation defined in swift-business-process.wsdl 
             -->
        <bpel:receive name="receiveInput" partnerLink="client" portType="tns:swift-business-process" operation="process" variable="input" createInstance="yes" />
        <bpel:sequence name="Sequence-Incident-Message">
            <bpel:assign validate="no" name="Assign-Incident">
			
			
			
		
            
            
            
            <bpel:copy><bpel:from><bpel:literal><inc:reportIncident xmlns:inc="http://aerolineas-latinoamericana.com/soa/processes/incidents-message/process-incidents-message/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <description>description</description>
  <summary>summary</summary>
  <category>0</category>
</inc:reportIncident>
</bpel:literal>
                
                </bpel:from><bpel:to part="parameters" variable="incident_input"></bpel:to>
            
            
            
            </bpel:copy>
            <bpel:copy keepSrcElementName="no"><bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
            	
                    
                    
                    
                    
                    
                    
                    
                    
                    <![CDATA[$input.payload/tns:input/tns:incidentsReport/tns:description]]>
                </bpel:from>
				<bpel:to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    <![CDATA[$incident_input.parameters/description]]>
				</bpel:to>
			
            </bpel:copy>
            <bpel:copy keepSrcElementName="no"><bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    
                    
                    
                    
                    
                    
                    <![CDATA[$input.payload/tns:input/tns:incidentsReport/tns:summary]]>
                </bpel:from>
				<bpel:to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    <![CDATA[$incident_input.parameters/summary]]>
				</bpel:to>
			
            </bpel:copy>
            <bpel:copy keepSrcElementName="no"><bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    
                    
                    <![CDATA[$input.payload/tns:input/tns:incidentsReport/tns:category]]>
                </bpel:from>
                <bpel:to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    <![CDATA[$incident_input.parameters/category]]>
                </bpel:to>
			
            </bpel:copy>
        </bpel:assign>
            <bpel:invoke name="Invoke-incident-service" partnerLink="incidentServicePartnerLink" operation="reportIncident" portType="inc:incidentBinding" inputVariable="incident_input" outputVariable="incident_output"></bpel:invoke>
        </bpel:sequence>
        <bpel:sequence name="Sequence-crew-message">
            <bpel:assign validate="no" name="Assign-Crew">
			
			
			
		
            
            
            
            <bpel:copy><bpel:from><bpel:literal><proc:changeCrew xmlns:proc="http://aerolineas-latinoamericana.com/soa/processes/crew-message/process-crew-message/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <applyChangesOnCrewMembers>true</applyChangesOnCrewMembers>
  <totalCrewMemberRequired>0</totalCrewMemberRequired>
  <changePilot>changePilot</changePilot>
</proc:changeCrew>
</bpel:literal>
                
                </bpel:from><bpel:to part="parameters" variable="crew_input"></bpel:to>
            
            
            
            </bpel:copy>
            <bpel:copy keepSrcElementName="no"><bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    
                    
                    
                    
                    
                    
                    
                    <![CDATA[$input.payload/tns:input/tns:crewPlaningChanges/tns:applyChangesOnCrewMembers]]>
                </bpel:from>
				<bpel:to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
					<![CDATA[$crew_input.parameters/applyChangesOnCrewMembers]]>
				</bpel:to>
			
            </bpel:copy>
            <bpel:copy keepSrcElementName="no"><bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    
                    
                    <![CDATA[$input.payload/tns:input/tns:crewPlaningChanges/tns:totalCrewMemberRequired]]>
                </bpel:from>
				<bpel:to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    <![CDATA[$crew_input.parameters/totalCrewMemberRequired]]>
				</bpel:to>
			
            </bpel:copy>
            <bpel:copy keepSrcElementName="no"><bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    
                    
                    <![CDATA[$input.payload/tns:input/tns:crewPlaningChanges/tns:changePilot]]>
                </bpel:from>
				<bpel:to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    <![CDATA[$crew_input.parameters/changePilot]]>
				</bpel:to>
			
            </bpel:copy>
        </bpel:assign>
            <bpel:invoke name="Invoke-crew-service" partnerLink="crewServicePartnerLink" operation="changeCrew" portType="proc:CrewPortType" inputVariable="crew_input" outputVariable="crew_output">
            </bpel:invoke>
        </bpel:sequence>
        
        
        
        
        <bpel:sequence name="Sequence-business-rule">
            <bpel:assign validate="no" name="Assign-BRMS">
			

			
		
            
            
            <bpel:copy>
                <bpel:from><bpel:literal><tns:evaluateRule xmlns:tns="http://javeriana-maintenance/brms" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:ValidarMaintenanceFact>
    <status>status</status>
    <fuelPercentage>0</fuelPercentage>
    <skipMaintenance>true</skipMaintenance>
  </tns:ValidarMaintenanceFact>
</tns:evaluateRule>
</bpel:literal>
                
                </bpel:from><bpel:to part="parameters" variable="brms_input"></bpel:to>
            
            
            </bpel:copy>
            <bpel:copy><bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    
                    
                    
                    
                    
                    
                    <![CDATA[$input.payload/tns:input/tns:maintenance/tns:undercarriageStatus]]>
                </bpel:from>
				<bpel:to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    <![CDATA[$brms_input.parameters/brms:ValidarMaintenanceFact/status]]>
				</bpel:to>
			
            </bpel:copy>
            <bpel:copy><bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <![CDATA[$input.payload/tns:input/tns:maintenance/tns:fuelPercentage]]>
                </bpel:from>
				<bpel:to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    <![CDATA[$brms_input.parameters/brms:ValidarMaintenanceFact/fuelPercentage]]>
				</bpel:to>

			
            </bpel:copy>
        </bpel:assign>
            <bpel:invoke name="invoke-brms-service" partnerLink="businessRuleServicePartnerLink" operation="evaluateRule" portType="brms:businessRulePortType" inputVariable="brms_input" outputVariable="brms_output">
            </bpel:invoke>
            <bpel:if name="If">
                <bpel:condition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[$brms_output.parameters/brms:ValidarMaintenanceFact/skipMaintenance = 'false']]></bpel:condition>
                <bpel:sequence>
                    <bpel:assign validate="no" name="Assign-maintenance">
                    
                    
                    
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <bpel:copy keepSrcElementName="yes">
                            <bpel:from><bpel:literal><mop:mopEvent xmlns:mop="http://aerolineas-latinoamericana.com/soa/mop-message/mop-rule/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <undercarriage>undercarriage</undercarriage>
  <fuelPercentage>0</fuelPercentage>
  <skipMaintenance>true</skipMaintenance>
</mop:mopEvent>
</bpel:literal>
                            
                            </bpel:from><bpel:to part="parameters" variable="mop_input"></bpel:to>
                        
                        
                        </bpel:copy>
                        <bpel:copy keepSrcElementName="no"><bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                <![CDATA[$input.payload/tns:input/tns:maintenance/tns:fuelPercentage]]>
                            
                            </bpel:from><bpel:to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                
                                
                                
                                
                                
                                
                                <![CDATA[$mop_input.parameters/fuelPercentage]]>
                            </bpel:to>
                    
                        
                        
                        </bpel:copy>
                        <bpel:copy keepSrcElementName="no"><bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                
                                
                                
                                
                                
                                
                                
                                
                                <![CDATA[$input.payload/tns:input/tns:maintenance/tns:undercarriageStatus]]>
                            
                            </bpel:from><bpel:to expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                
                                
                                
                                
                                <![CDATA[$mop_input.parameters/undercarriage]]>
                            </bpel:to>
                    
                        
                        
                        </bpel:copy>
                    </bpel:assign>
                    <bpel:sequence name="Sequence">
                        <bpel:assign validate="no" name="Assign-filter">
                            <bpel:copy>
                                <bpel:from><bpel:literal><tns:evaluateAircraft xmlns:tns="http://mtx.enterprise/services/filter" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <request>
    <aicraftModel>0</aicraftModel>
    <aircraftType>aircraftType</aircraftType>
  </request>
</tns:evaluateAircraft>
</bpel:literal></bpel:from>
                                <bpel:to variable="filter_input" part="parameters"></bpel:to>
                            </bpel:copy>
                            
                            
                        </bpel:assign>
                        
                        <bpel:invoke name="Invoke-filter" partnerLink="filterPartnerLink" operation="evaluateAircraft" portType="fil:FilterService"></bpel:invoke>
                        <bpel:invoke name="Invoke-reporting" partnerLink="reportingPartnerLink" operation="generate" portType="rep:ReportingWS"></bpel:invoke>
                    </bpel:sequence>
                    
                </bpel:sequence>
            </bpel:if>
        </bpel:sequence>
        
        
        
        
        
		
		
        
        
        
		

		


        <bpel:invoke name="Invoke1"></bpel:invoke>
        <bpel:assign validate="no" name="Assign-transactionCode">
			
			
            <bpel:copy>
                <bpel:from>
                    <bpel:literal><tns:swift-business-processResponse xmlns:tns="http://swift.business.process" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:transactionCode>tns:transactionCode</tns:transactionCode>
</tns:swift-business-processResponse>
</bpel:literal>
                </bpel:from>
                <bpel:to part="payload" variable="output"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <![CDATA[concat('TransactionCode:' , round(1200), ' OK')]]>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:transactionCode]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
        
        <bpel:reply name="Reply" partnerLink="client" operation="process"
			portType="tns:swift-business-process" variable="output"></bpel:reply>        
        
    </bpel:sequence>
</bpel:process>

